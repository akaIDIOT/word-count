<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title> PyCon.here / DUPLO™ Bootcamp </title>
    <link href="assets/default.css" rel="stylesheet" type="text/css" />
    <link href="assets/pygments.css" rel="stylesheet" type="text/css" />
</head>
<body>

<div id="impress" data-transition-duration="150">
    
        <div class="slide step">
            <h1>Python alsof het <em>echte</em> software is</h1>
<p><img alt="DUPLO" src="assets/duplo.svg" /></p>

            <div class="slide-num">
                1 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Hoezo?!</h2>
<ul>
<li>FBDA's weapon of choice</li>
<li>zowel losse scripts  als 'libs'</li>
<li>herbruikbaarheid non-triviaal</li>
<li>geringe ervaring met tooling</li>
<li>impulsgroep DUPLO™</li>
</ul>

            <div class="slide-num">
                2 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Invulling</h2>
<ul>
<li>typisch los script (doet het!): <code>wordcount.py</code></li>
<li>nou nog herbruikbaar…</li>
<li>spelen met veelgebruikte tooling<ul>
<li><code>pytest</code>, <code>setuptools</code>, <code>sphinx</code>, <code>tox</code>, <code>wheel</code>, …</li>
<li>PyCharm</li>
</ul>
</li>
<li>disclaimer: dit is een dive, geen <em>deep</em> dive</li>
</ul>

            <div class="slide-num">
                3 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Not Invented Here™</h2>
<ul>
<li>github's trending python projects als inspiratie (<code>keras</code>, <code>requests</code>, …)</li>
<li>project-layout (<code>test_dingen.py</code> of <code>tests/test_iets.py</code>, …)</li>
<li>gebruikte tools (<code>pytest</code> of <code>unittest2</code>, …)</li>
<li>verder: "populaire conventie"</li>
</ul>

            <div class="slide-num">
                4 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>What TODO</h2>
<ul>
<li><code>virtualenv</code></li>
<li>unittests met <code>pytest</code></li>
<li>packaging met <code>setuptools</code> en <code>wheel</code></li>
<li>documentatie met <code>sphinx</code></li>
<li>automatisering met <code>tox</code></li>
<li>eventueel<ul>
<li>'lint' met <code>flake8</code></li>
<li>test/code coverage met <code>coverage</code></li>
</ul>
</li>
</ul>

            <div class="slide-num">
                5 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Requirements</h2>
<ul>
<li><code>git --version</code></li>
<li><code>python3 --version</code></li>
<li><code>pip --version</code> (verwijst naar welke versie van Python?)<ul>
<li>eventueel <code>pip3</code></li>
</ul>
</li>
<li><code>pip show pip</code></li>
<li>PyCharm (community of professional)</li>
</ul>

            <div class="slide-num">
                6 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Woordjes tellen</h2>
<ul>
<li>live meeklikken (of kopie-pasta): <code>https://akaidiot.github.com/word-count/</code></li>
</ul>
<div class="codehilite"><pre><span></span>$ git clone https://github.com/akaIDIOT/word-count.git
$ python3 wordcount.py map/met/tekst
[(&#39;de&#39;, 123), (&#39;het&#39;, 45), (&#39;een&#39;, 6)]
</pre></div>


<ul>
<li>PyCharm</li>
<li><code>virtualenv</code></li>
</ul>

            <div class="slide-num">
                7 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Virtual reality</h2>
<p>Alle DUPLO-blokken netjes in de doos:</p>
<div class="codehilite"><pre><span></span>$ pip install virtualenv
$ virtualenv --python python3 pad/naar/env
$ source pad/naar/env/activate   # *nix
$ pad\naar\env\Scripts\activate  # windows
</pre></div>

            <div class="slide-num">
                8 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Virtual reality: PyCharm</h2>
<p><img alt="interpreter in PyCharm" src="assets/project-interpreter.png" /></p>

            <div class="slide-num">
                9 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Virtual reality</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                10 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Unit tests</h2>
<ul>
<li>een 'unit' is klein</li>
<li><code>wordcount.py</code> is niet handig testbaar ☹ (één unit)</li>
<li>eerst fixen of eerst tests maken?<ul>
<li>pragmatisme of test driven development</li>
</ul>
</li>
</ul>
<p><em>populaire conventie: test-code in <code>…/tests/</code></em></p>

            <div class="slide-num">
                11 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Unit tests: pytest</h2>
<div class="codehilite"><pre><span></span>$ pip install pytest
</pre></div>


<p><code>…/tests/test_wordcount.py</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_tokenize</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;De kat krabt de krullen van de trap.&#39;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s1">&#39;krullen&#39;</span> <span class="ow">in</span> <span class="n">words</span>
    <span class="k">assert</span> <span class="s1">&#39;trap&#39;</span> <span class="ow">in</span> <span class="n">words</span>
</pre></div>

            <div class="slide-num">
                12 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Unit tests: PyCharm</h2>
<p><img alt="pytest in PyCharm" src="assets/test-runner.png" /></p>
<p>Rechts-klik op <code>tests</code>, ▶ Run 'py.test in tests'</p>

            <div class="slide-num">
                13 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Bonus tests</h2>
<p><code>pytest</code> heeft handige helpers, <code>pyhamcrest</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup> maakt één en ander leesbaarder:</p>
<div class="codehilite"><pre><span></span><span class="nd">@pytest.mark.parametrize</span><span class="p">(</span><span class="s1">&#39;text, words&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">&#39;testing</span><span class="se">\n</span><span class="s1">123&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;testing&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">]),</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                <span class="n">contains_inanyorder</span><span class="p">(</span><span class="o">*</span><span class="n">words</span><span class="p">))</span>
</pre></div>


<p><code>mock</code> / <code>unittest.mock</code> kan dingen die in de weg zitten (HTTP-requests, database-cursors, …) 'mocken'</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>importeer uit module <code>hamcrest</code>&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

            <div class="slide-num">
                14 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Unit tests</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                15 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging</h2>
<ul>
<li>pakketje wat Python 'snapt'</li>
<li>Python packages, modules <em>en dependencies</em></li>
</ul>
<p><em>(niet alleen) populaire conventie: <code>…/setup.py</code></em></p>

            <div class="slide-num">
                16 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging: <code>setup.py</code></h2>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>


<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wordcount&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>             <span class="c1"># see PEP-440</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Count words, duh&#39;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Henk de Vries&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;henk.de.vries@nfi.minvenj.nl&#39;</span><span class="p">,</span>
    <span class="n">py_modules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wordcount&#39;</span><span class="p">],</span>  <span class="c1"># single module</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[],</span>       <span class="c1"># no dependencies</span>
<span class="p">)</span>
</pre></div>

            <div class="slide-num">
                17 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging: <code>wordcount.tar.gz</code></h2>
<div class="codehilite"><pre><span></span>$ python setup.py bdist
$ ls dist/
wordcount-0.0.linux-x86_64.tar.gz
</pre></div>


<p>euh… <code>x86_64</code>? <code>.tar.gz</code>? ☹</p>

            <div class="slide-num">
                18 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging: <code>wordcount.whl</code></h2>
<div class="codehilite"><pre><span></span>$ pip install wheel
$ python setup.py bdist_wheel
$ ls dist/
wordcount-0.0-py3-none-any.whl
</pre></div>


<p>oeh, <code>py3-none-any</code>, <code>.whl</code> ☺</p>

            <div class="slide-num">
                19 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging: <code>pip install wordcount</code></h2>
<ul>
<li>afdeling heeft een PyPI-server (😘 FIG)</li>
<li>iedereen heeft leesrechten</li>
<li>schrijfrechten op aanvraag</li>
<li>configuratie op confluence</li>
</ul>
<div class="codehilite"><pre><span></span>$ twine upload --repository dbs dist/*.whl
</pre></div>

            <div class="slide-num">
                20 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Packaging</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                21 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: Spinx</h2>
<ul>
<li>krachtige tool, maar veel TLC nodig…</li>
<li>geconfigureerd in Python</li>
<li>genereert documentatie vanaf <code>index.rst</code></li>
<li>reStructuredText (☹)</li>
<li>importeert code, rendert docstrings zoals bijv. <em>readthedocs.org</em></li>
</ul>

            <div class="slide-num">
                22 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: Sphinx</h2>
<div class="codehilite"><pre><span></span>$ pip install sphinx
$ cd …/word-count
$ sphinx-quickstart
&gt; Root path for the documentation [.]: docs
&gt; autodoc: automatically insert docstrings from modules (y/n) [n]: y
&gt; Create Makefile? (y/n) [y]: n
&gt; Create Windows command file? (y/n) [y]: n
</pre></div>


<p><em>populaire conventie: doc root in <code>…/docs/</code></em></p>

            <div class="slide-num">
                23 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: <code>conf.py</code></h2>
<p>vies, maar hier nodig…</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
</pre></div>

            <div class="slide-num">
                24 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: <code>index.rst</code></h2>
<div class="codehilite"><pre><span></span><span class="p">..</span> <span class="ow">toctree</span><span class="p">::</span>
   <span class="nc">:maxdepth:</span> <span class="nf">2</span>
   <span class="nc">:caption:</span> <span class="nf">Contents:</span>

   api
</pre></div>

            <div class="slide-num">
                25 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: <code>api.rst</code></h2>
<div class="codehilite"><pre><span></span><span class="gh">API Docs</span>
<span class="gh">========</span>

<span class="p">..</span> <span class="ow">automodule</span><span class="p">::</span> wordcount
   <span class="nc">:members:</span>
   <span class="nc">:undoc-members:</span>
</pre></div>


<p>Niet per se fijn, eventueel in <code>conf.py</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">autodoc_default_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;members&#39;</span><span class="p">,</span> <span class="s1">&#39;undoc-members&#39;</span><span class="p">]</span>
</pre></div>


<p>Zie <a href="http://www.sphinx-doc.org/en/stable/ext/autodoc.html">Sphinx' <code>autodoc</code> doc</a> voor meer</p>

            <div class="slide-num">
                26 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: PyCharm</h2>
<p><img alt="Spinx in PyCharm" src="assets/new-docs-runner.png" /></p>

            <div class="slide-num">
                27 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie: PyCharm</h2>
<p><img alt="Spinx in PyCharm" src="assets/docs-runner.png" /></p>

            <div class="slide-num">
                28 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Documentatie</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                29 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Automatisering: tox</h2>
<ul>
<li>soort van <code>Makefile</code></li>
<li>één of meerdere 'testenvs'</li>
<li>maakt zelf virtual envs</li>
<li>daarna soort van shell script</li>
<li>vooral handig voor build servers, herhaalbaarheid buiten je eigen bubbel</li>
</ul>
<p><em>populaire conventie: <code>…/tox.ini</code></em></p>

            <div class="slide-num">
                30 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Automatisering: <code>tox.ini</code></h2>
<p>normaliter <em>buiten</em> de virtualenv voor je project:</p>
<div class="codehilite"><pre><span></span>$ pip install tox
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">[testenv]</span>
<span class="na">commands</span> <span class="o">=</span><span class="s"></span>
<span class="s">    …</span>
<span class="na">deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">    …</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ tox
…
</pre></div>

            <div class="slide-num">
                31 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Automatisering: tests en docs</h2>
<div class="codehilite"><pre><span></span><span class="c1"># &#39;default&#39; testenv</span>
<span class="k">[testenv]</span>
<span class="na">commands</span> <span class="o">=</span><span class="s"></span>
<span class="s">    py.test --strict tests/</span>
<span class="na">deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">    pytest</span>

<span class="c1"># non-default testenv named &quot;docs&quot;</span>
<span class="k">[testenv:docs]</span>
<span class="na">commands</span> <span class="o">=</span><span class="s"></span>
<span class="s">    sphinx-build -b html docs/ dist/docs/</span>
<span class="na">deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">    sphinx</span>
</pre></div>

            <div class="slide-num">
                32 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Automatisering: Python versies</h2>
<div class="codehilite"><pre><span></span><span class="c1"># global config</span>
<span class="k">[tox]</span>
<span class="na">envlist</span> <span class="o">=</span> <span class="s">py33, py34, py35, py36</span>
<span class="na">skip_missing_interpreters</span> <span class="o">=</span> <span class="s">True</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ tox
…  # (times 4)
</pre></div>


<p>kan veel meer, zie vooral <a href="https://tox.readthedocs.io">tox.readthedocs.io</a></p>

            <div class="slide-num">
                33 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Automatisering</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                34 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Style-checking</h2>
<ul>
<li>programma's die zeuren dat je code lelijk™ is (bijv. PyCharm ☺)</li>
<li>voor Python vrij goed gedefinieerd: PEP-8</li>
<li>uniform met andere projecten; 'pythonic'</li>
<li><em>populaire conventie: <code>flake8</code></em><ul>
<li>kent PEP-8 vrij goed</li>
<li>zeurt per regel</li>
<li>kan regels overslaan</li>
</ul>
</li>
</ul>

            <div class="slide-num">
                35 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Style checking: automatisering</h2>
<div class="codehilite"><pre><span></span><span class="k">[testenv]</span>
<span class="c1"># any failing command stops and fails env</span>
<span class="na">commands</span> <span class="o">=</span><span class="s"></span>
<span class="s">    flake8 wordcount.py</span>
<span class="s">    py.test --strict tests/</span>
<span class="c1"># flake8 does plugins, like pep8-naming</span>
<span class="na">deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">    flake8</span>
<span class="s">    flake8-comprehensions</span>
<span class="s">    pep8-naming</span>
<span class="s">    pytest</span>
</pre></div>

            <div class="slide-num">
                36 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Style checking</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                37 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Code coverage</h2>
<ul>
<li>bijhouden welke code wel en niet geraakt is door een test</li>
<li>geen doel, maar fijn middel om te zien of je test doet wat je bedoelde</li>
<li><em>populaire conventie: <code>coverage</code></em></li>
</ul>

            <div class="slide-num">
                38 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Code coverage: automatisering</h2>
<div class="codehilite"><pre><span></span><span class="k">[testenv]</span>
<span class="c1"># let coverage run py.test, generate HTML-report in dist</span>
<span class="na">commands</span> <span class="o">=</span><span class="s"></span>
<span class="s">    coverage run --branch --source hansken --module py.test --strict tests/</span>
<span class="s">    coverage html --dir dist/coverage/</span>
<span class="na">deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">    coverage</span>
<span class="s">    pytest</span>
</pre></div>

            <div class="slide-num">
                39 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Code coverage: resultaat</h2>
<p><img alt="coverage in PyCharm" src="assets/coverage-html.png" /></p>

            <div class="slide-num">
                40 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Code coverage: PyCharm (Professional)</h2>
<p><img alt="coverage in PyCharm" src="assets/run-coverage.png" /></p>
<p><img alt="coverage in PyCharm" src="assets/coverage-pycharm.png" /></p>

            <div class="slide-num">
                41 / 42
            </div>
        </div>
    
        <div class="slide step">
            <h2>Code coverage</h2>
<p><img alt="thumbs up" src="assets/thumbs-up.svg" /></p>

            <div class="slide-num">
                42 / 42
            </div>
        </div>
    
</div>

<script src="assets/impress.js"></script>
<script>
    impress().init();
</script>

</body>

</html>